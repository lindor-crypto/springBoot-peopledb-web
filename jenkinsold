        stage('Build avec Gradle') {
            steps {
                echo "======== Construction du projet ========"
                sh 'chmod +x gradlew'
                sh './gradlew --no-daemon clean build -x test'
            }
        }

        stage('Tests unitaires') {
            steps {
                echo "======== Ex√©cution des tests ========"
                sh './gradlew --no-daemon test'
            }
        }

        stage('Analyse Checkstyle') {
            steps {
                echo "======== Analyse Checkstyle ========"
                sh './gradlew --no-daemon checkstyleMain'
            }
        }

        stage('Archivage du JAR') {
            steps {
                echo "======== Archivage de l\'artefact ========"
                archiveArtifacts artifacts: 'build/libs/*.jar', fingerprint: true
            }
        }

        stage('Build App Image') {
            steps {
                dir('app/springboot-peopledb-web') {
                    script {
                        dockerImage = docker.build(appRegistry + ":$BUILD_NUMBER")
                    }
                }
            }
        }

        stage('Upload App Image') {
            steps {
                script {
                    docker.withRegistry(vprofileRegistry, registryCredential) {
                        dockerImage.push("$BUILD_NUMBER")
                        dockerImage.push('latest')
                    }
                }
            }
        }

        stage('Remove Docker Image') {
            steps {
                echo "üßπ Suppression de l'image Docker apr√®s le build..."
                sh 'docker rmi -f $(docker images -a -q) || true'
            }
        }

        stage('Deploy to ecs') {
            steps {
                withAWS(credentials: 'awscreds', region: 'us-east-1') {
                    sh 'aws ecs update-service --cluster ${cluster} --service ${service} --force-new-deployment'
                }
            }
        }